{
  "policyUpi": "PC-AWS-API-833",
  "policyId": "8d65d3b7-75f2-4628-b07b-ab574041dbdf",
  "policyType": "config",
  "cloudType": "aws",
  "severity": "medium",
  "name": "AWS API Gateway Rest API attached WAFv2 WebACL is not configured with AMR for Log4j Vulnerability",
  "description": "This policy identifies AWS API Gateway Rest API attached with WAFv2 WebACL which are not configured with AWS Managed Rules (AMR) for Log4j Vulnerability. As per the guidelines given by AWS, API Gateway Rest API attached with WAFv2 WebACL should be configured with AWS Managed Rules (AMR) AWSManagedRulesKnownBadInputsRuleSet and AWSManagedRulesAnonymousIpList to protect from Log4j Vulnerability (CVE-2021-44228).\n\nFor more information please refer below URL,\nhttps://aws.amazon.com/security/security-bulletins/AWS-2021-006/",
  "rule.criteria": "599de04f-e7d5-4254-8e18-72a46f389125",
  "searchModel.query": "config from cloud.resource where api.name = 'aws-apigateway-get-stages' AND json.rule = webAclArn is not empty as X; config from cloud.resource where api.name = 'aws-waf-v2-web-acl-resource' AND json.rule = NOT ( webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesAnonymousIpList and webACL.rules[*].statement.managedRuleGroupStatement.name contains AWSManagedRulesKnownBadInputsRuleSet ) as Y; filter '$.Y.webACL.arn equals $.X.webAclArn'; show X;",
  "recommendation": "1. Sign in to the AWS console\n2. Go to the API Gateway console\n3. Click on the reported API Gateway REST API\n4. In the Stages pane, choose the name of the stage\n5. In the Stage Editor pane, choose the Settings tab\n6. Note down the associated AWS WAF web ACL\n7. Go to the noted WAF web ACL in AWS WAF & Shield Service\n8. Under 'Rules' tab click on 'Add rules' and select 'Add managed rule groups'\n9. Under 'AWS managed rule groups' enable 'Anonymous IP list' and 'Known bad inputs'\n10. Click on 'Add rules'",
  "remediable": false,
  "remediation.cliScriptTemplate": "",
  "remediation.description": "",
  "remediation.impact": "",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "Australian Energy Sector Cyber Security Framework (AESCSF)",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "Cybersecurity Maturity Model Certification (CMMC) v.2.0 (Level 1)",
    "FFIEC",
    "PCI DSS v4.0"
  ]
}